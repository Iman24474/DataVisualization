---
title: "DataVisualization"
output:
  html_document: default
  pdf_document: default
date: "2024-02-06"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(ggplot2)
library(tidyr)
library(dplyr)
library(gapminder)
library(patchwork)
```

# A Gapminder Plot

#### 1. The basic plot can be created with ggplot and aesthetic mappings:

```{r}
gm2007 <- filter(gapminder, year == 2007)
ggplot(gm2007) +
  geom_point(aes(x = gdpPercap,
                 y = lifeExp,
                 size = pop,
                 color = continent)) +
  scale_x_log10() +
  ylim(c(20, 85))
```

#### 2. With some adjustments the basic plot can be brought close to the Gapminder version in appearance:

```{r}
gm2007 <- filter(gapminder, year == 2007) |>
  arrange(desc(pop)) ## Sort to avoid over-plotting
ggplot(gm2007) +
  geom_point(aes(x = gdpPercap,
                 y = lifeExp,
                 size = pop,
                 fill = continent),
             shape = 21) + ## to allow the using 'fill' aesthetic
  scale_x_log10() +
  ylim(c(20, 85)) +
  scale_size_area(max_size = 20,
                  labels = waiver() ,
                  breaks = c(0.25 * 10 ^ 9, 0.5 * 10 ^ 9, 10 ^ 9)) +
  scale_fill_manual(values = c(Africa = "deepskyblue",
                               Asia = "red",
                               Americas = "green",
                               Europe = "gold",
                               Oceania = "brown")) +
  labs(x = "Income" , y = "Life Expectancy") +
  theme(text = element_text(size = 16)) +
  guides(fill = guide_legend(title = "Continent",
                             override.aes = list(size = 5), order = 1),
         size = guide_legend(title = "Population",
                             label.hjust = 1,
                             order = 2)) + 
  theme_minimal() + 
  theme(panel.border = element_rect(fill = NA, color = "grey20"))


```

#### 3. To judge the marginal association between life expectancy and population size we can change the channel mapping:

-   map the horizontal axis to population;
-   map area to income.

```{r}
gm2007 <- filter(gapminder, year == 2007)
ggplot(gm2007) +
  geom_point(aes(x = pop,
                 y = lifeExp,
                 size = gdpPercap)) +
  scale_x_log10() +
  ylim(c(20, 85)) +
  theme_minimal() +
  theme(panel.border = element_rect(fill = NA,
                                    color = "grey20"))

```
#### 4. Similar Plots with Different Variables and Shared Encodings 
One way to show three continuous variables is with two plots that share an axis:

```{r}
gm2007 <- filter(gapminder, year == 2007)
pe_thm <- theme_minimal() +
  theme(panel.background = element_rect(color = "black",
                                        linewidth = 0.5,
                                        fill = NA))
p1 <- ggplot(gm2007, aes(x = gdpPercap, 
                         y = lifeExp, 
                         color = continent)) +
  geom_point() +
  scale_x_log10() +
  guides(color = "none") +
  pe_thm

p2 <- ggplot(gm2007, aes(x = pop / 10^6,
                         y = lifeExp,
                         color = continent)) +
  geom_point() + 
  scale_x_log10() +
  pe_thm +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

p1 + p2


```

#### 5. Different Plots with Shared Encodings
Multiple views of the data are often helpful.

Sharing encodings makes the relations between views easier to perceive.

```{r}
gm2007 <- filter(gapminder, year == 2007)

p3 <- ggplot(gm2007, aes(x = pop / 10 ^ 6,
                         y = reorder(continent, pop, FUN = sum),
                         fill = continent)) +
  geom_col() +
  ylab(NULL) +
  pe_thm

p1 + p3
```

#### 6. Small Multiples
These plot collections are also called trellis plots, lattice plots, or faceted plots.

A plot of life expectancy against income per capita in 2007 faceted by continent:

```{r}
gm2007 <- filter(gapminder, year == 2007)
gd <- filter(gapminder, year %in% c(1977,1987,1997,2007))
fct_thm <- theme_minimal() +
  theme(panel.background = element_rect(color = "black",
                                        linewidth = 0.5,
                                        fill = NA))
ggplot(gm2007, aes(x = gdpPercap,
                   y = lifeExp,
                   color = continent)) +
  geom_point(size = 2.5) +
  scale_x_log10() +
  facet_wrap(~ continent) +
  fct_thm

```

A useful variation is to show a muted view of the full data in the background:

```{r}
ggplot(gm2007, aes(x = gdpPercap, y = lifeExp, color = continent)) +
    geom_point(data = mutate(gm2007, continent = NULL), color = "grey80") +
    geom_point(size = 2.5) +
    scale_x_log10() +
    facet_wrap(~ continent) +
    fct_thm

```







